<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>幻想的な液体と霧</title>
  <style>body{margin:0;overflow:hidden;background:#000;}</style>
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
      "orbitcontrols": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/controls/OrbitControls.js",
      "effectcomposer": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/postprocessing/EffectComposer.js",
      "renderpass": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/postprocessing/RenderPass.js",
      "unrealbloom": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/postprocessing/UnrealBloomPass.js"
    }
  }
  </script>
</head>
<body>
<script type="module">
import * as THREE from "three";
import { OrbitControls } from "orbitcontrols";
import { EffectComposer } from "effectcomposer";
import { RenderPass } from "renderpass";
import { UnrealBloomPass } from "unrealbloom";

// シーン
const scene = new THREE.Scene();
scene.fog = new THREE.FogExp2(0x000000, 0.05);

// カメラ
const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 100);
camera.position.set(0, 0, 6);

// レンダラー
const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(innerWidth, innerHeight);
document.body.appendChild(renderer.domElement);

// コントロール
new OrbitControls(camera, renderer.domElement);

// 液体っぽい球
const sphereGeo = new THREE.SphereGeometry(1.2, 128, 128);
const sphereMat = new THREE.MeshPhysicalMaterial({
  color: new THREE.Color(0x66ccff),
  metalness: 0.2,
  roughness: 0.3,
  transparent: true,
  opacity: 0.7,
  transmission: 0.8,
  clearcoat: 1.0,
  clearcoatRoughness: 0.2
});
const sphere = new THREE.Mesh(sphereGeo, sphereMat);
scene.add(sphere);

// 霧のようなリング
const ringGeo = new THREE.RingGeometry(2.5, 3, 128);
const ringMat = new THREE.MeshBasicMaterial({
  color: 0xffffff,
  transparent: true,
  opacity: 0.15,
  side: THREE.DoubleSide
});
const ring = new THREE.Mesh(ringGeo, ringMat);
ring.rotation.x = Math.PI/2;
scene.add(ring);

// ポストプロセス（幻想的なぼかし）
const composer = new EffectComposer(renderer);
composer.addPass(new RenderPass(scene, camera));
const bloomPass = new UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.2, 0.6, 0.1);
composer.addPass(bloomPass);

// 頂点変形のためのオリジナル位置
const origPos = sphereGeo.attributes.position.array.slice();

// アニメーション
function animate(time){
  requestAnimationFrame(animate);

  // 球を液体のように変形（ランダム反響感）
  const pos = sphereGeo.attributes.position;
  for(let i=0; i<pos.count; i++){
    const ix = i*3, iy = i*3+1, iz = i*3+2;
    const ox = origPos[ix], oy = origPos[iy], oz = origPos[iz];
    const noise = Math.sin(time*0.001 + ox*3 + oy*2 + oz*5);
    const scale = 1 + 0.05*noise;
    pos.setXYZ(i, ox*scale, oy*scale, oz*scale);
  }
  pos.needsUpdate = true;

  // リングを淡く脈動
  ring.scale.setScalar(1.0 + 0.1*Math.sin(time*0.001));

  composer.render();
}
animate();
</script>
</body>
</html>
