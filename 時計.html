<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>幻想的なリング＋球体</title>
<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
    "OrbitControls": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/controls/OrbitControls.js"
  }
}
</script>
</head>
<body style="margin:0; background:#f5f5f5;">
<canvas id="myCanvas"></canvas>
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'OrbitControls';

const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.z = 8;

const renderer = new THREE.WebGLRenderer({canvas:document.getElementById("myCanvas"), antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);

// 中央の幻想的な球体
const sphereGeo = new THREE.SphereGeometry(1.2, 64, 64);
const sphereMat = new THREE.ShaderMaterial({
  uniforms: {
    time: { value: 0.0 }
  },
  vertexShader: `
    varying vec2 vUv;
    void main(){
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
    }
  `,
  fragmentShader: `
    uniform float time;
    varying vec2 vUv;
    void main(){
      float glow = 0.6 + 0.4*sin(time*0.5 + vUv.x*5.0);
      gl_FragColor = vec4(1.0, 1.0, 1.0, glow);
    }
  `,
  transparent:true
});
const sphere = new THREE.Mesh(sphereGeo, sphereMat);
scene.add(sphere);

// 幻想的な淡い色リスト
const ringColors = [
  new THREE.Color(0.9,0.7,0.9),
  new THREE.Color(0.7,0.8,0.95),
  new THREE.Color(0.8,0.95,0.8)
];

// リング作成シェーダー
function createRing(color, radius){
  const geometry = new THREE.RingGeometry(radius*0.95, radius*1.05, 128);
  const material = new THREE.ShaderMaterial({
    uniforms: {
      color: { value: color },
      time: { value: 0.0 }
    },
    vertexShader: `
      varying vec2 vUv;
      void main(){
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4(position,1.0);
      }
    `,
    fragmentShader: `
      uniform vec3 color;
      uniform float time;
      varying vec2 vUv;
      void main(){
        float dist = abs(vUv.x - 0.5);
        float alpha = smoothstep(0.5,0.0,dist*1.8); // 境目を淡く
        float wave = 0.05*sin(time*0.5 + vUv.y*10.0);
        alpha *= 0.6 + wave;
        gl_FragColor = vec4(color, alpha);
      }
    `,
    transparent:true,
    side:THREE.DoubleSide
  });
  return new THREE.Mesh(geometry, material);
}

// 初期3リング
const rings = [];
for(let i=0;i<3;i++){
  const ring = createRing(ringColors[i%ringColors.length], 2.0+i*0.6);
  scene.add(ring);
  rings.push(ring);
}

const controls = new OrbitControls(camera, renderer.domElement);

let clock = new THREE.Clock();
function animate(){
  requestAnimationFrame(animate);
  let t = clock.getElapsedTime();

  sphere.material.uniforms.time.value = t;

  rings.forEach((ring,i)=>{
    ring.material.uniforms.time.value = t + i;
    ring.rotation.z = 0.1*Math.sin(t*0.3+i); // ゆらゆら揺れ
    ring.rotation.x = 0.05*Math.sin(t*0.2+i*0.5);
  });

  renderer.render(scene,camera);
}
animate();

window.addEventListener("resize",()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
