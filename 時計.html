<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>幻想的な液体リングと球体</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { margin:0; overflow:hidden; background:#f0f0f0; }
    canvas { display:block; }
  </style>
</head>
<body>
<!-- Three.js本体と追加モジュール -->
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script>
  // --- 基本設定 ---
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 2000);
  camera.position.z = 12;

  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  // --- ポストプロセス: Bloom効果で幻想的に ---
  const composer = new THREE.EffectComposer(renderer);
  const renderPass = new THREE.RenderPass(scene, camera);
  composer.addPass(renderPass);
  const bloom = new THREE.UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.0, 0.9, 0.1);
  bloom.threshold = 0.05;
  bloom.strength = 1.2;
  bloom.radius = 0.8;
  composer.addPass(bloom);

  // --- ライティング ---
  const ambient = new THREE.AmbientLight(0xffffff, 0.6);
  scene.add(ambient);
  const point = new THREE.PointLight(0xffffff, 0.8);
  point.position.set(5,5,10);
  scene.add(point);

// --- 中央の発光球体 ---
const sphereGeo = new THREE.SphereGeometry(2.0, 96, 96);
const sphereMat = new THREE.MeshStandardMaterial({
  color: 0xffffff,
  emissive: 0xffffff,
  emissiveIntensity: 1.5, // 発光を強く
  roughness: 0.5,
  metalness: 0.0
});
const glowSphere = new THREE.Mesh(sphereGeo, sphereMat);
scene.add(glowSphere);

// --- 球体の外側に柔らかい虹色グラデーション ---
const glowCanvas = document.createElement("canvas");
glowCanvas.width = glowCanvas.height = 512;
const gctx = glowCanvas.getContext("2d");
const gr = gctx.createRadialGradient(256, 256, 100, 256, 256, 250);
gr.addColorStop(0.0, "rgba(255,255,255,1)");
gr.addColorStop(0.3, "rgba(255,255,255,0.6)");
gr.addColorStop(0.5, "rgba(255,200,200,0.4)");
gr.addColorStop(0.7, "rgba(200,255,200,0.3)");
gr.addColorStop(0.9, "rgba(200,200,255,0.2)");
gr.addColorStop(1.0, "rgba(255,255,255,0)");
gctx.fillStyle = gr;
gctx.fillRect(0,0,512,512);

const glowTex = new THREE.CanvasTexture(glowCanvas);
const glowMat = new THREE.MeshBasicMaterial({
  map: glowTex,
  transparent: true,
  blending: THREE.AdditiveBlending,
  depthWrite: false,
  opacity: 0.9,
  side: THREE.DoubleSide
});
const glowPlane = new THREE.Mesh(new THREE.PlaneGeometry(6,6), glowMat);
scene.add(glowPlane);

  // --- リングを3色追加 ---
  const ring1 = createRing(3.0, 'rgba(102,217,255,1)', 0.5); // 青系
  const ring2 = createRing(4.0, 'rgba(178,102,255,1)', 0.5); // 紫系
  const ring3 = createRing(5.0, 'rgba(255,120,160,1)', 0.5); // ピンク系
  scene.add(ring1, ring2, ring3);

  // --- 背景の淡いリング（霧の演出） ---
  const bgRing = createRing(8.0, 'rgba(200,200,255,0.3)', 0.3);
  bgRing.position.z = -5;
  scene.add(bgRing);

  // --- アニメーション ---
  const clock = new THREE.Clock();
  function animate() {
    requestAnimationFrame(animate);
    const t = clock.getElapsedTime();

    // 球体の液体的揺らぎ
    const arr = posAttr.array;
    for (let i=0;i<vertexCount;i++) {
      const idx = i*3;
      const ox = origPositions[idx], oy = origPositions[idx+1], oz = origPositions[idx+2];
      const p = phases[i];
      const n = Math.sin(ox*1.2 + t*0.8 + p) + Math.cos(oy*1.3 + t*0.6 + p*0.5);
      const disp = n * 0.08;
      arr[idx]   = ox + (ox/2) * disp;
      arr[idx+1] = oy + (oy/2) * disp;
      arr[idx+2] = oz + (oz/2) * disp;
    }
    posAttr.needsUpdate = true;
    sphereGeo.computeVertexNormals();

    // リングのゆらゆら回転
    ring1.rotation.z += 0.002;
    ring2.rotation.z -= 0.0015;
    ring3.rotation.z += 0.001;

    // リング全体をふわふわ揺らす
    ring1.rotation.x = 0.05 * Math.sin(t*0.7);
    ring2.rotation.y = 0.04 * Math.cos(t*0.5);
    ring3.rotation.x = 0.03 * Math.sin(t*0.9);

    // 背景リングの淡い脈動
    bgRing.material.opacity = 0.2 + 0.1*Math.sin(t*0.4);

    composer.render();
  }
  animate();

  // --- リサイズ対応 ---
  window.addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
    composer.setSize(innerWidth, innerHeight);
  });
</script>
</body>
</html>
