<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>液体のように変形する球体</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.min.js"></script>

<script>
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.z = 6;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ========== 液体球体のシェーダー ==========
const uniforms = {
  time: { value: 0.0 },
  color: { value: new THREE.Color(0x99ccff) }
};

const liquidShader = {
  uniforms: uniforms,
  vertexShader: `
    uniform float time;
    varying vec3 vNormal;

    // 疑似ノイズ
    float noise(vec3 p) {
      return sin(p.x*2.0 + time) * 0.3 +
             sin(p.y*3.0 + time*0.7) * 0.3 +
             sin(p.z*4.0 + time*1.3) * 0.3;
    }

    void main() {
      vNormal = normal;
      // 頂点をnormal方向に変形（中心はそのまま）
      float displacement = noise(normal + time*0.2) * 0.25;
      vec3 newPosition = position + normal * displacement;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
    }
  `,
  fragmentShader: `
    uniform vec3 color;
    uniform float time;
    varying vec3 vNormal;

    void main(){
      float intensity = 0.6 + 0.4 * sin(time*2.0 + vNormal.x*5.0);
      gl_FragColor = vec4(color * intensity, 1.0);
    }
  `
};

// 球体ジオメトリ
const sphereGeo = new THREE.SphereGeometry(1.5, 128, 128);
const sphereMat = new THREE.ShaderMaterial({
  uniforms: uniforms,
  vertexShader: liquidShader.vertexShader,
  fragmentShader: liquidShader.fragmentShader,
  transparent: true,
  side: THREE.DoubleSide
});
const sphere = new THREE.Mesh(sphereGeo, sphereMat);
scene.add(sphere);

// ========== アニメーション ==========
function animate(){
  requestAnimationFrame(animate);
  uniforms.time.value += 0.02;

  // 球体をふわっと呼吸するように拡縮
  let scale = 1.0 + 0.03 * Math.sin(uniforms.time.value);
  sphere.scale.set(scale, scale, scale);

  renderer.render(scene, camera);
}
animate();

// レスポンシブ対応
window.addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
