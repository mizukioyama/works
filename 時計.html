<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>幻想的な液体リングと球体</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <style>
    body { margin:0; overflow:hidden; background:#f0f0f0; }
    canvas { display:block; }
  </style>
</head>
<body>
<!-- Three.js本体と追加モジュール -->
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/postprocessing/EffectComposer.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/postprocessing/RenderPass.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/js/postprocessing/UnrealBloomPass.js"></script>

<script>
  // --- 基本設定 ---
  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 2000);
  camera.position.z = 12;

  const renderer = new THREE.WebGLRenderer({ antialias:true });
  renderer.setSize(innerWidth, innerHeight);
  document.body.appendChild(renderer.domElement);

  // --- ポストプロセス ---
  const composer = new THREE.EffectComposer(renderer);
  composer.addPass(new THREE.RenderPass(scene, camera));
  const bloom = new THREE.UnrealBloomPass(new THREE.Vector2(innerWidth, innerHeight), 1.0, 0.9, 0.1);
  bloom.threshold = 0.05;
  bloom.strength = 1.2;
  bloom.radius = 0.8;
  composer.addPass(bloom);

  // --- ライティング ---
  scene.add(new THREE.AmbientLight(0xffffff, 0.8));

  // --- 中央の発光球体 ---
  const sphereGeo = new THREE.SphereGeometry(2.0, 96, 96);
  const sphereMat = new THREE.MeshStandardMaterial({
    color: 0xffffff,
    emissive: 0xffffff,
    emissiveIntensity: 1.5,
    roughness: 0.5,
    metalness: 0.0
  });
  const glowSphere = new THREE.Mesh(sphereGeo, sphereMat);
  scene.add(glowSphere);

  // --- 外側の柔らかい虹色のにじみ ---
  const glowCanvas = document.createElement("canvas");
  glowCanvas.width = glowCanvas.height = 512;
  const gctx = glowCanvas.getContext("2d");
  const gr = gctx.createRadialGradient(256, 256, 100, 256, 256, 250);
  gr.addColorStop(0.0, "rgba(255,255,255,1)");
  gr.addColorStop(0.3, "rgba(255,255,255,0.6)");
  gr.addColorStop(0.5, "rgba(255,200,200,0.4)");
  gr.addColorStop(0.7, "rgba(200,255,200,0.3)");
  gr.addColorStop(0.9, "rgba(200,200,255,0.2)");
  gr.addColorStop(1.0, "rgba(255,255,255,0)");
  gctx.fillStyle = gr;
  gctx.fillRect(0,0,512,512);

  const glowTex = new THREE.CanvasTexture(glowCanvas);
  const glowMat = new THREE.MeshBasicMaterial({
    map: glowTex,
    transparent: true,
    blending: THREE.AdditiveBlending,
    depthWrite: false,
    opacity: 0.9,
    side: THREE.DoubleSide
  });
  const glowPlane = new THREE.Mesh(new THREE.PlaneGeometry(6,6), glowMat);
  scene.add(glowPlane);

  // --- アニメーション ---
  function animate() {
    requestAnimationFrame(animate);
    composer.render();
  }
  animate();

  // --- リサイズ対応 ---
  window.addEventListener('resize', ()=>{
    camera.aspect = innerWidth/innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(innerWidth, innerHeight);
    composer.setSize(innerWidth, innerHeight);
  });
</script>
</body>
</html>
