<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>幻想的な虹色リング</title>
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js",
      "OrbitControls": "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/controls/OrbitControls.js"
    }
  }
  </script>
</head>
<body style="margin:0; background:#e5e5e5;">
<canvas id="canvas"></canvas>
<script type="module">
import * as THREE from "three";
import { OrbitControls } from "OrbitControls";

const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById("canvas"), antialias:true });
renderer.setSize(window.innerWidth, window.innerHeight);

const scene = new THREE.Scene();
const camera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0.1, 10);
camera.position.z = 1;

const uniforms = {
  u_time: { value: 0.0 },
  u_resolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) }
};

const material = new THREE.ShaderMaterial({
  uniforms: uniforms,
  transparent: true,
  fragmentShader: `
    precision highp float;
    uniform float u_time;
    uniform vec2 u_resolution;

    void main() {
      vec2 uv = (gl_FragCoord.xy / u_resolution) * 2.0 - 1.0;
      float r = length(uv);

      // ゆらぎを加える
      float wobble = 0.03 * sin(u_time*0.8 + uv.x*5.0) * cos(u_time*0.6 + uv.y*5.0);
      r += wobble;

      // 複数のリングを作る
      float ring1 = smoothstep(0.45, 0.47, r) - smoothstep(0.47, 0.50, r);
      float ring2 = smoothstep(0.60, 0.62, r) - smoothstep(0.62, 0.65, r);
      float ring3 = smoothstep(0.75, 0.77, r) - smoothstep(0.77, 0.80, r);

      // 色合い（虹色グラデーション）
      vec3 col = vec3(1.0);
      float hue = atan(uv.y, uv.x) / 6.2831 + 0.5;
      vec3 rainbow = vec3(
        0.5 + 0.5*sin(6.2831*hue),
        0.5 + 0.5*sin(6.2831*hue + 2.094),
        0.5 + 0.5*sin(6.2831*hue + 4.188)
      );

      // 各リングの強さ
      col += rainbow * ring1 * 0.8;
      col += rainbow * ring2 * 0.6;
      col += rainbow * ring3 * 0.4;

      // 中央に白い光
      float centerGlow = smoothstep(0.4, 0.0, r);
      col += vec3(1.0,1.0,1.0) * centerGlow * 1.5;

      gl_FragColor = vec4(col, 1.0);
    }
  `
});

const plane = new THREE.Mesh(new THREE.PlaneGeometry(2,2), material);
scene.add(plane);

const controls = new OrbitControls(camera, renderer.domElement);

function animate(t) {
  uniforms.u_time.value = t * 0.001;
  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}
animate(0);

window.addEventListener("resize", () => {
  renderer.setSize(window.innerWidth, window.innerHeight);
  uniforms.u_resolution.value.set(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
