<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>幻想的な液体と霧</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/controls/OrbitControls.js"></script>

<script>
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.z = 8;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ========== 液体の球体 ==========
const uniforms = {
  time: { value: 0.0 },
  color: { value: new THREE.Color(0x99ccff) } // 幻想的な水色
};

const liquidShader = {
  uniforms: uniforms,
  vertexShader: `
    uniform float time;
    varying vec3 vNormal;

    // 簡易ノイズ
    float rand(vec3 c){
      return fract(sin(dot(c ,vec3(12.9898,78.233,45.164))) * 43758.5453);
    }

    void main(){
      vNormal = normal;
      float noise = rand(normal + time * 0.5);
      float displacement = 0.3 * sin(time + noise * 6.28);
      vec3 newPosition = position + normal * displacement;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
    }
  `,
  fragmentShader: `
    uniform vec3 color;
    uniform float time;
    varying vec3 vNormal;
    void main(){
      float intensity = 0.5 + 0.5 * sin(time + vNormal.x*5.0);
      gl_FragColor = vec4(color * intensity, 0.9);
    }
  `
};

const sphereGeo = new THREE.SphereGeometry(1.5, 128, 128);
const sphereMat = new THREE.ShaderMaterial({
  uniforms: uniforms,
  vertexShader: liquidShader.vertexShader,
  fragmentShader: liquidShader.fragmentShader,
  transparent: true,
  side: THREE.DoubleSide
});
const sphere = new THREE.Mesh(sphereGeo, sphereMat);
scene.add(sphere);

// ========== 霧のようなリング ==========
const rings = [];
const colors = [0xff99cc, 0x99ffcc, 0xcc99ff]; // 幻想的な3色

for (let i = 0; i < 6; i++) {
  const ringGeo = new THREE.RingGeometry(2+i*0.5, 2.2+i*0.5, 128);
  const ringMat = new THREE.MeshBasicMaterial({
    color: colors[i % colors.length],
    transparent: true,
    opacity: 0.3,
    side: THREE.DoubleSide
  });
  const ring = new THREE.Mesh(ringGeo, ringMat);
  ring.rotation.x = Math.random() * Math.PI;
  ring.rotation.y = Math.random() * Math.PI;
  scene.add(ring);
  rings.push(ring);
}

// ========== アニメーション ==========
function animate(){
  requestAnimationFrame(animate);
  uniforms.time.value += 0.01;

  // 球体をふわふわスケーリング
  let scale = 1.0 + 0.05 * Math.sin(uniforms.time.value * 2.0);
  sphere.scale.set(scale, scale, scale);

  // リングをランダムにフェードさせる（霧っぽさ）
  rings.forEach((ring, i) => {
    ring.rotation.z += 0.002 * (i % 2 === 0 ? 1 : -1);
    ring.material.opacity = 0.15 + 0.15 * Math.sin(uniforms.time.value * 1.5 + i);
    ring.scale.setScalar(1.0 + 0.05 * Math.sin(uniforms.time.value*2 + i));
  });

  renderer.render(scene, camera);
}
animate();

// レスポンシブ対応
window.addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
