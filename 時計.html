<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>液体のような球体と霧のリング</title>
  <style>
    body { margin: 0; background: black; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
<script type="module">
import * as THREE from "https://cdn.jsdelivr.net/npm/three@0.162.0/build/three.module.js";
import { OrbitControls } from "https://cdn.jsdelivr.net/npm/three@0.162.0/examples/jsm/controls/OrbitControls.js";

// ========== 基本セットアップ ==========
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);

// ========== ライト ==========
const light = new THREE.PointLight(0xffffff, 1.5);
light.position.set(5, 5, 5);
scene.add(light);
scene.add(new THREE.AmbientLight(0x666666));

// ========== 球体 (液体風ノイズシェーダー) ==========
const sphereGeometry = new THREE.IcosahedronGeometry(1, 6);
const sphereMaterial = new THREE.ShaderMaterial({
  uniforms: {
    time: { value: 0.0 },
    color: { value: new THREE.Color(0xffffff) }
  },
  vertexShader: `
    uniform float time;
    varying vec3 vNormal;
    // 3Dノイズ関数
    float noise(vec3 p){
      return sin(p.x*4.0 + time*2.0) * sin(p.y*4.0 + time*2.0) * sin(p.z*4.0 + time*2.0);
    }
    void main() {
      vNormal = normal;
      vec3 newPosition = position + normal * 0.2 * noise(position*1.5 + time*0.5);
      gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
    }
  `,
  fragmentShader: `
    uniform vec3 color;
    varying vec3 vNormal;
    void main() {
      float intensity = pow(0.5 - dot(normalize(vNormal), vec3(0.0, 0.0, 1.0)), 2.0);
      gl_FragColor = vec4(color * (0.5 + intensity), 1.0);
    }
  `,
  wireframe: false
});
const sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
scene.add(sphere);

// ========== リング (霧っぽいノイズ) ==========
const ringGeometry = new THREE.RingGeometry(1.5, 2.5, 128, 1);
const ringMaterial = new THREE.ShaderMaterial({
  uniforms: {
    time: { value: 0.0 },
    color1: { value: new THREE.Color(0xff9999) },
    color2: { value: new THREE.Color(0x99ccff) },
    color3: { value: new THREE.Color(0xccffcc) }
  },
  transparent: true,
  side: THREE.DoubleSide,
  vertexShader: `
    uniform float time;
    varying vec2 vUv;
    void main() {
      vUv = uv;
      vec3 pos = position;
      pos.z += sin(uv.x*10.0 + time*2.0) * 0.1;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
    }
  `,
  fragmentShader: `
    uniform float time;
    uniform vec3 color1;
    uniform vec3 color2;
    uniform vec3 color3;
    varying vec2 vUv;
    void main() {
      float alpha = smoothstep(0.0, 1.0, 1.0 - abs(vUv.y - 0.5)*2.0);
      vec3 color = mix(color1, color2, vUv.x + 0.5*sin(time*0.3));
      color = mix(color, color3, 0.5 + 0.5*sin(time*0.5));
      gl_FragColor = vec4(color, alpha*0.4);
    }
  `
});
const ring = new THREE.Mesh(ringGeometry, ringMaterial);
scene.add(ring);

// ========== アニメーション ==========
function animate() {
  requestAnimationFrame(animate);
  const t = performance.now() * 0.001;

  sphereMaterial.uniforms.time.value = t;
  ringMaterial.uniforms.time.value = t;

  sphere.rotation.y += 0.002;
  ring.rotation.z += 0.001;

  renderer.render(scene, camera);
}
animate();

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
