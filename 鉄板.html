<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>リアルな反射鉄板</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: #111;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 8px;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    label { display: block; margin-bottom: 6px; }
  </style>
</head>
<body>
  <div id="ui">
    <label>Metalness: <input id="metal" type="range" min="0" max="1" step="0.01" value="1"></label>
    <label>Roughness: <input id="rough" type="range" min="0" max="1" step="0.01" value="0.15"></label>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/examples/js/controls/OrbitControls.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.154.0/examples/js/loaders/RGBELoader.js"></script>

  <script>
    // ======== 基本設定 ========
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 1.2, 3);

    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    document.body.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // ======== 環境光 ========
    const ambient = new THREE.AmbientLight(0xffffff, 0.6);
    scene.add(ambient);

    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5, 5, 5);
    scene.add(dirLight);

    // ======== HDRI 環境マップ ========
    const rgbeLoader = new THREE.RGBELoader();
    rgbeLoader.load("https://threejs.org/examples/textures/equirectangular/royal_esplanade_1k.hdr", (texture) => {
      texture.mapping = THREE.EquirectangularReflectionMapping;
      scene.background = texture;
      scene.environment = texture;
    });

    // ======== 鉄板のマテリアル ========
    const plateMaterial = new THREE.MeshStandardMaterial({
      color: 0xaaaaaa,
      metalness: 1,
      roughness: 0.15
    });

    // ======== 鉄板のジオメトリ ========
    const plateGeometry = new THREE.PlaneGeometry(2.5, 1.5, 100, 100);

    // 少しだけ凹凸を付ける
    for (let i = 0; i < plateGeometry.attributes.position.count; i++) {
      const z = (Math.random() - 0.5) * 0.01;
      plateGeometry.attributes.position.setZ(i, z);
    }

    const plate = new THREE.Mesh(plateGeometry, plateMaterial);
    plate.rotation.x = -Math.PI / 2;
    scene.add(plate);

    // ======== UIの設定 ========
    document.getElementById("metal").addEventListener("input", (e) => {
      plateMaterial.metalness = parseFloat(e.target.value);
    });
    document.getElementById("rough").addEventListener("input", (e) => {
      plateMaterial.roughness = parseFloat(e.target.value);
    });

    // ======== 床 ========
    const floor = new THREE.Mesh(
      new THREE.PlaneGeometry(10, 10),
      new THREE.MeshStandardMaterial({ color: 0x222222, roughness: 0.8 })
    );
    floor.rotation.x = -Math.PI / 2;
    floor.position.y = -0.001;
    scene.add(floor);

    // ======== アニメーション ========
    function animate() {
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    }
    animate();

    // ======== ウィンドウリサイズ対応 ========
    window.addEventListener("resize", () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
